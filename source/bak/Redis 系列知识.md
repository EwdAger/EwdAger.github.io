---
title: 深度优先学习 Redis
tags:
  - Redis
categories: 知识储备
abbrlink: 396d8370
date: 2020-08-17 11:35:00
---

> 意识流警告


# Redis 为什么这么快

1. 完全基于内存，绝大部分请求是纯粹的内存操作。而且存储的数据结构类似`Dict`，查询和操作的时间复杂度都是O(1)。

2. 处理网络请求（存取数据）的时候使用单线程，避免不必要的上下文切换和竞争条件。又没因为可能出现死锁而导致的性能消耗。

3. 多路 I/O 复用模型。利用`select`、`poll`、`epoll`可以同时监控多个流的 I/O 事件能力，在空闲的时候，会把当前线程阻塞掉，当有一个或多个流有 I/O 事件时，就从阻塞态中唤醒，然后依次处理就绪的流，避免了大量无用的操作。

# 为什么要用多路 I/O 复用模型

首先我们面临类似如下的这种问题。

> 现在我们的餐厅来了30桌客人，但是只有一个服务员，如何最快的处理客人的点餐请求。

1. 服务员逐桌为客人点餐，当客人在纠结选什么菜的时候，服务员只能傻等。 这是阻塞I/O模型。

2. 当服务员在处理一桌客人的点餐时，其他客人发起了点单请求，服务员会马上吼一句没空。隔一段时间客人再发起点单请求直到服务员处理。 这是非阻塞I/O模型。

3. 为每一桌放一个服务铃，当客人选好菜后再按铃让服务员快速的依次处理点菜请求。这是I/O多路复用模型

4. 每一桌客人自己点菜，点好菜把点单放在桌子前，服务员依次去拿点好的菜单。这是异步I/O模型（类似消息队列了）

## 阻塞I/O模型和非阻塞I/O模型的区别

调用阻塞I/O模型的时候会一直block对应进程直到操作完成，而非阻塞I/O模型在kernel还在准备数据的情况下会立刻返回。

## 多路复用 I/O 模型

多路复用 I/O 模型就是我们说的`select`，`poll`，`epoll`，同时也称作事件驱动I/O。

`select/epoll`的好处就在于单个process就可以同时处理多个网络连接的IO。它的基本原理就是`select`，`poll`，`epoll`这个function会不断的轮询所负责的所有socket，当某个socket有数据到达了，就通知用户进程。当用户进程调用了select，那么整个进程会被block，而同时，kernel会“监视”所有select负责的socket，当任何一个socket中的数据准备好了，select就会返回。这个时候用户进程再调用read操作，将数据从kernel拷贝到用户进程。


## select、poll、epoll详解

